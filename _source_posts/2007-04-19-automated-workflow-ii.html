---
layout: post
status: publish
published: true
title: Automated Workflow II
author:
  display_name: Aaron
  login: Aaron
  email: aaron@singleservingphoto.com
  url: http://gallery.aaronbieber.com
author_login: Aaron
author_email: aaron@singleservingphoto.com
author_url: http://gallery.aaronbieber.com
excerpt: "In the \"last chapter of my Automated Workflow series\":http://www.singleservingphoto.com/2007/04/15/automated-workflow-i/,
  I showed you how to use some neat scripting tricks to apply watermarks to your photos
  automatically. In this chapter, I'm going to talk about naming and organizing photos
  and show you how to set up some scripts to make things easier for you.\r\n\r\nYou
  have a bunch of pretty photos; shouldn't they have pretty names?"
wordpress_id: 104
wordpress_url: http://www.singleservingphoto.com/2007/04/19/automated-workflow-ii/
date: '2007-04-19 22:26:20 -0400'
date_gmt: '2007-04-20 02:26:20 -0400'
categories:
- Articles
tags:
- technology
- howto
- applescript
- guide
- programming
- software
- workflow
comments: []
---
<p>In the "last chapter of my Automated Workflow series":http://www.singleservingphoto.com/2007/04/15/automated-workflow-i/, I showed you how to use some neat scripting tricks to apply watermarks to your photos automatically. In this chapter, I'm going to talk about naming and organizing photos and show you how to set up some scripts to make things easier for you.</p>
<p>You have a bunch of pretty photos; shouldn't they have pretty names?<a id="more"></a><a id="more-104"></a></p>
<p>I always name my photographs. Even if the names are sometimes trite or clichéd, I think that any photo that has worked its way into the gallery deserves a name. When I put photos into "my gallery":http://www.fisheyegallery.com, I like to name the files themselves with the name of the photograph so that the URLs are pretty. It makes more sense to see a URL like @/Places/Chicago/MillenniumPark.jpg.html@ than something ugly like @/plc/chg-il/chg-mp-01.jpg@, don't you think?</p>
<p>One thing I hate is to do things more than once. Isn't that why we have computers? "So," I thought to myself, "if I'm going to enter the names of the photos into the @Title@ field of their metadata anyway," which I do, "shouldn't I be able to read that out somehow and name the file with it?" Yes, yes I can. This is because I am a nerd. It is this power that I will give you today. Nerd power.</p>
<p>h2. Getting the Programs</p>
<p>First, you're going to need a working installation of "MacPorts":http://www.macports.org. In my "previous article":http://www.singleservingphoto.com/2007/04/15/automated-workflow-i/ I explained how to get that working, so go over that part again if you need to. I will assume you have it installed, even if you didn't install the ports I talked about last time.</p>
<p>Now install a program called @exiv2@, which is a terminal utility for reading Exif and other data out of (primarily) JPEG files. Installing it should be as easy as opening up your terminal program of choice and typing:</p>
<p><code lang="text"><br />
airborne@Auriga ~ $ sudo port install exiv2<br />
</code></p>
<p>Remember, you're only typing the part after the dollar sign. You will probably be prompted for your password and then it'll run off and download things and install them for you. Once it's done, make sure it worked by running the program:</p>
<p><code lang="text"><br />
airborne@Auriga ~ $ exiv2<br />
exiv2: An action must be specified<br />
exiv2: At least one file is required<br />
Usage: exiv2 [ options ] [ action ] file ...</p>
<p>Manipulate the Exif metadata of images.<br />
</code></p>
<p>It should look more or less like that. If you get a @-bash: exiv2: command not found@ error, that's not good, so you should look back at what MacPorts told you during the installation to find out what went wrong. Now that you have @exiv2@ installed, you can use it to read information out of files. Here is what the basic output of @exiv2@ looks like if you don't specify any extra options:</p>
<p><code lang="text"><br />
airborne@Auriga ~ $ exiv2 24Jun06-03.jpg<br />
Filename        : 24Jun06-03.jpg<br />
Filesize        : 147491 Bytes<br />
Camera make     : Canon<br />
Camera model    : Canon EOS 10D<br />
Image timestamp : 2006:06:24 17:45:27<br />
Image number    :<br />
Exposure time   : 1/90 s<br />
Aperture        : F11<br />
Exposure bias   : 0<br />
Flash           : No<br />
Flash bias      :<br />
Focal length    : 44.0 mm<br />
Subject distance:<br />
ISO speed       : 200<br />
Exposure mode   :<br />
Metering mode   : Matrix<br />
Macro mode      :<br />
Image quality   :<br />
Exif Resolution :<br />
White balance   :<br />
Thumbnail       : None<br />
Copyright       : Copyright (c) 2006 Aaron Bieber<br />
Exif comment    :<br />
</code></p>
<p>But wait, there's no image name in there, only the filename! By default, @exiv2@ only prints out the Exif data, not any of the IPTC data, which is where things like the image's creator, URL, title, etc., are stored. We can tell @exiv2@ to print out IPTC data by using the @-pi@ switch. By the way, you can find out what else it can do by asking it for help with @exiv2 --help@.</p>
<p><code lang="text"><br />
airborne@Auriga ~ $ exiv2 -pi 24Jun06-03.jpg<br />
Iptc.Application2.RecordVersion              Short       1  2<br />
Iptc.Application2.ObjectName                 String     17  Onward, Upward II<br />
Iptc.Application2.Keywords                   String     13  portrait ilva<br />
Iptc.Application2.Byline                     String     12  Aaron Bieber<br />
Iptc.Application2.Copyright                  String     31  Copyright (c) 2006 Aaron Bieber<br />
</code></p>
<p>h2. Shelling out the Name!</p>
<p>You can see that this JPEG has been given a title (in the IPTC spec. they call it ObjectName), a couple of keywords, a byline (the creator's name, usually), and a copyright notice. What we want is just the value of ObjectName. We can get this with a piece of shell scripting like so:</p>
<p><code lang="bash"><br />
exiv2 -pi "a-file-with-metadata.jpg" | grep ObjectName | cut -c 61- | tr -cd "[:alpha:]"<br />
</code></p>
<p>I'm not going to explain how this works; the fun of @bash@ is looking up each command and figuring out how it all comes together. If you want to figure it out, I'm confident that you will. If not, that's okay, you can still use it! Suffice it to say, that line should output _only_ the title of the image, or nothing if there isn't one. We need to save that into a little script so that it can be given a filename to work on and so it can check to make sure everything works the way it's supposed to. To that end, here is the script:</p>
<p><code lang="bash"><br />
#!/bin/sh</p>
<p>if [[ ! -z "$1" && -e "$1" ]]; then<br />
    EXIV="/opt/local/bin/exiv2"<br />
    TITLE=`$EXIV -pi "${1}" 2>/dev/null | grep ObjectName | cut -c 61- | tr -cd "[:alpha:]"`;<br />
    if [ -z "$TITLE" ]; then<br />
        echo "There is no title in the metadata."<br />
        exit 1<br />
    else<br />
        `mv "$1" "$TITLE.jpg"`;<br />
        exit 0<br />
    fi<br />
else<br />
    echo "You must supply a filename and the file must exist."<br />
    exit 0<br />
fi<br />
</code></p>
<p>*Note:* You may have to change the path to @exiv2@ in the part that starts @EXIV=@ if MacPorts installed it in a different place than where it is on my system. In all likelihood it's in the same place, but you can check by running @which exiv2@. Use the path printed by that command in your script.</p>
<p>This script takes the filename of your photograph as an argument and renames the file with that name. It also removes any non-alphanumeric characters from the title to make sure the filename will be valid. If you wanted to change spaces into hyphens instead of removing them or something else along those lines, you'd want to examine and alter the @tr@ portion of the long command at the beginning.</p>
<p>Save that script into a file and make sure it's executable by running @chmod u+x yourscriptname@, and you're done!</p>
<p>h2. Making a Droplet</p>
<p>Well, almost. Wouldn't it be handy to be able to drag and drop a bunch of photos onto an icon and have this thing rename them all at once? You bet it would. We can easily make an AppleScript droplet that will do that, just like I showed you in the previous chapter! Here's the code:</p>
<p><code lang="applescript"><br />
on open theObjects<br />
    repeat with theObject in theObjects<br />
        do shell script "~/bin/namewithtitles " & "'" & ¬<br />
        (POSIX path of theObject as string) & "'"<br />
    end repeat<br />
end open<br />
</code></p>
<p>Hit Save As and make sure to select "application" as the type and also make sure that the "Startup Screen" option is unchecked. You really don't want that one.</p>
<p>If all has gone according to plan, you should be able to drag photos onto the droplet and they should be renamed for you! Of course, they must have title information in the IPTC header; Lightroom calls the field Title and will export that data with your images automatically.</p>
<p>If you felt the urge, you could integrate these AppleScript commands into the post-processing script for Lightroom that I showed you how to set up in the previous chapter. I will leave that as a challenge for the adventurous reader.</p>
<p>Until next time, fellow photo-nerds.</p>
